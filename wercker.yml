box: leipert/atom-apm
# Build definition
build:
  # The steps that will be executed on build
  steps:
    - npm-install
    - script:
        name: Run gulp
        code: gulp
    - script:
        name: Remove unneeded files
        code: >
          cp -rf src/README.md README.md &&
          rm -rf {grammars,settings,snippets}/gfm.cson script src gulpfile.js clean.sh
    - script:
        name: Test package
        code: >
          start-stop-daemon --start --pidfile /tmp/xvfb_99.pid --make-pidfile
          --background --exec /usr/bin/Xvfb -- :99 -screen 0 1024x768x24 -ac
          +extension GLX +extension RANDR +render -noreset &&
          sleep 3 &&
          export DISPLAY=:99 &&
          apm test
